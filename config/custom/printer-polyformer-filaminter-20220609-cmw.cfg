# This file contains common pin mappings for the BIGTREETECH SKR Pico V1.0
# To use this config, the firmware should be compiled for the RP2040 with
# USB communication.

# The "make flash" command does not work on the SKR Pico V1.0. Instead,
# after running "make", copy the generated "out/klipper.uf2" file
# to the mass storage device in RP2040 boot mode

# See docs/Config_Reference.md for a description of parameters.

# Calibration:
#    - calibrate PID settings on extruder, open console and do:  
#        - Set the part cooling fans to 25%: `M106 S64`
#        - run PID calibration: `PID_CALIBRATE HEATER=extruder TARGET=170`
#        - save the resilts in the `printer.cfg`file: `SAVE_CONFIG`
#
# References
#    - [TMC2209 Stepper driver](https://www.trinamic.com/fileadmin/assets/Products/ICs_Documents/TMC2209_Datasheet_V103.pdf)

# Adddtional configs
[include mainsail.cfg]
[include macros.cfg]

[mcu]
serial: /dev/serial0
restart_method: command

[extruder]
step_pin: gpio14
dir_pin: !gpio13
enable_pin: !gpio15
microsteps: 32           # TMC2209 driver supports: 8, 16, 32, or 64 microsteps (TODO: Add this to my config-and-calibration-README.md)
rotation_distance: 27    # TODO: What is the gear ratio? 1:27?
nozzle_diameter: 1.7
filament_diameter: 1.75
heater_pin: gpio23
sensor_type: Generic 3950
sensor_pin: gpio27
control = pid
pid_kp = 27.155
pid_ki = 1.403
pid_kd = 131.361
min_temp: 0
max_temp: 300
min_extrude_temp: 170

[tmc2209 extruder]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 3
run_current: 1.4
#hold_current: 0.600
sense_resistor: 0.140
#stealthchop_threshold: 99999

[gcode_macro T0]
gcode:
    ACTIVATE_EXTRUDER EXTRUDER=extruder

# debugging: increasing the heater gain to temporarily ignore any heater/thermistor 
#[verify_heater extruder]
#check_gain_time: 60

# Triggered when the extruder is turned on
[heater_fan extruder_fan]
pin: gpio20
max_power: 1.0
shutdown_speed: 1.0
cycle_time: 0.01
kick_start_time: 0.5
heater: extruder
heater_temp: 50.0
fan_speed: 0.7

[temperature_sensor raspberry_pi]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

[printer]
kinematics: none
max_velocity: 500
max_accel: 3000

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 27.155
#*# pid_ki = 1.403
#*# pid_kd = 131.361
